<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>Confirm email â€” ToDoList</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 520px; margin: 40px auto; padding: 0 16px; }
        .msg { padding: 14px; border-radius: 10px; background: #f5f5f5; white-space: pre-wrap; }
    </style>
</head>
<body>
<h2>Email confirmation</h2>
<div id="msg" class="msg">Confirming...</div>

<script>
    const API_BASE = "https://todolist-api-cxb9bufjb8hpcvh8.polandcentral-01.azurewebsites.net";

    const params = new URLSearchParams(window.location.search);
    const token = params.get("token");
    const msg = document.getElementById("msg");

    if (!token) {
        msg.textContent = "Missing token.";
    } else {
        fetch(`${API_BASE}/api/auth/confirm-email?token=` + encodeURIComponent(token))
            .then(async (res) => {
                if (res.ok) {
                    msg.textContent = "Your email has been confirmed. You can now log in.";
                } else {
                    let text = "";
                    try { text = await res.text(); } catch (e) {}
                    msg.textContent =
                        "Confirmation link is invalid or expired.\n" +
                        "Please request a new confirmation email.\n\n" +
                        (text ? ("Server said: " + text) : "");
                }
            })
            .catch((e) => {
                msg.textContent = "Something went wrong. Please try again later.\n" + (e?.message || "");
            });
    }
</script>
</body>
</html>
